// This file is a slightly modified version of <http://lichess1.org/assets/compiled/lichess.lobby.min.js>.
// I claim no copyright or ownership of any sort to the code that follows.
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.LichessLobby=e()}}(function(){var e;return function t(e,n,r){function o(i,s){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return o(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){var r=e("mithril"),o=e("./ctrl"),a=e("./view/main");t.exports=function(e,t){var n=new o(t);return r.module(e,{controller:function(){return n},view:a}),{socketReceive:n.socket.receive,setTab:function(e){n.setTab(e),r.redraw()},gameActivity:n.gameActivity,setRedirecting:n.setRedirecting}},window.Chessground=e("chessground")},{"./ctrl":19,"./view/main":27,chessground:13,mithril:18}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var i=r[0],s=r.length;(e||"object"!==o(i))&&(i={});for(var c=0;s>c;++c){var l=r[c],u=o(l);if("object"===u)for(var d in l){var f=e?a.clone(l[d]):l[d];i[d]=t?n(i[d],f):f}}return i}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var a=function(e){return r(e===!0,!1,arguments)},i="merge";a.recursive=function(e){return r(e===!0,!0,arguments)},a.clone=function(e){var t,n,r=e,i=o(e);if("array"===i)for(r=[],n=e.length,t=0;n>t;++t)r[t]=a.clone(e[t]);else if("object"===i){r={};for(t in e)r[t]=a.clone(e[t])}return r},e?t.exports=a:window[i]=a}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(e,t,n){function r(e,t,n){var r=n?u.invertKey(e):e;return{key:r,pos:u.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function a(e,t){return t.sort(function(t,n){return u.distance(e.pos,t.pos)-u.distance(e.pos,n.pos)})[0]}function i(e,t){var n=t.bounds(),i=n.width/8,s=n.height/8,c={},l=[],d=[],f=[],h=[],p=e.orientation!==t.orientation,m={},g="white"===t.orientation;for(var v in e.pieces){var b=r(v,e.pieces[v],p);m[b.key]=b}for(var y=0;y<u.allKeys.length;y++){var k=u.allKeys[y];if(k!==t.movable.dropped[1]){var w=t.pieces[k],x=m[k];w?x?o(w,x)||(f.push(x),h.push(r(k,w,!1))):h.push(r(k,w,!1)):x&&f.push(x)}}return h.forEach(function(e){var t=a(e,f.filter(u.partial(o,e)));if(t){var n=g?t.pos:e.pos,r=g?e.pos:t.pos,d=[(n[0]-r[0])*i,(r[1]-n[1])*s];c[e.key]=[d,d],l.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||u.containsX(l,e.key)||d.push({piece:{role:e.role,color:e.color},left:12.5*(g?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(g?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:c,fadings:d}}function s(e,t){return Math.round(e*t)/t}function c(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[s(o[0][0]*n,10),s(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=s(n,100);e.render(),u.requestAnimationFrame(function(){c(e)})}}}function l(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),a=i(n,t);if(Object.keys(a.anims).length>0||a.fadings.length>0){var s=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:a.anims,fadings:a.fadings},s||c(t)}else t.renderRAF();return o}var u=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return l(u.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":16}],4:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:function(){return e.data.orientation},getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,cancelPremove:e.cancelPremove,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode}}},{"./board":5}],5:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=M.opposite(e.orientation)}function a(e){e.lastMove=null,g(e,null),l(e)}function i(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function s(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function c(e,t,n){e.premovable.current=[t,n],r(M.partial(e.premovable.events.set,t,n))}function l(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function u(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=M.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var a,i,s,c=M.key2pos(n);if(7===c[0]||8===c[0])a=M.pos2key([8,o[1]]),i=M.pos2key([6,o[1]]),s=M.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return;a=M.pos2key([1,o[1]]),i=M.pos2key([4,o[1]]),s=M.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[a],e.pieces[s]={role:"king",color:r.color},e.pieces[i]={role:"rook",color:r.color}}}}}function d(e,t,n){var o=P(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(M.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,u(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function f(e,t,n){var r=d(e,t,n);return r&&(e.movable.dests={},e.turnColor=M.opposite(e.turnColor)),r}function h(e,t,n){return d(e,t,n)}function p(e,t,n){if(n)if(b(e,t,n)){if(f(e,t,n)){var o=j.stop();return g(e,null),r(M.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else k(e,t,n)?(c(e,t,n),g(e,null)):v(e,n)||y(e,n)?(g(e,n),j.start()):g(e,null);else j.cancel(),g(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function m(e,t){e.selected?t?e.selected!==t?p(e,e.selected,t)&&(e.stats.dragged=!1):j.start():(g(e,null),j.cancel()):(v(e,t)||y(e,t))&&(g(e,t),j.start()),t&&r(M.partial(e.events.select,t))}function g(e,t){e.selected=t,e.premovable.dests=t&&y(e,t)?A(e.pieces,t,e.premovable.castle):null}function v(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function b(e,t,n){return t!==n&&v(e,t)&&(e.movable.free||M.containsX(e.movable.dests[t],n))}function y(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function k(e,t,n){return t!==n&&y(e,t)&&M.containsX(A(e.pieces,t,e.premovable.castle),n)}function w(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function x(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1];b(e,n,o)&&f(e,n,o)&&r(M.partial(e.movable.events.after,n,o,{premove:!0})),l(e)}}function T(e){l(e),m(e,null)}function C(e){e.movable.color=null,e.movable.dests={},T(e)}function E(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?M.pos2key([r,o]):void 0}}function O(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}var M=e("./util"),A=e("./premove"),P=e("./anim"),j=e("./hold");t.exports={reset:a,toggleOrientation:o,setPieces:i,setCheck:s,selectSquare:m,setSelected:g,isDraggable:w,canMove:b,userMove:p,apiMove:h,playPremove:x,unsetPremove:l,cancelMove:T,stop:C,getKeyAtDomPos:E,getMaterialDiff:O}},{"./anim":3,"./hold":12,"./premove":14,"./util":16}],6:[function(e,t,n){var r=e("merge"),o=e("./board"),a=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=a.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<10)&&(e.animation.enabled=!1))}},{"./board":5,"./fen":11,merge:2}],7:[function(e,t,n){var r=e("./board"),o=e("./data"),a=e("./fen"),i=e("./configure"),s=e("./anim"),c=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return a.write(this.data.pieces)}.bind(this),this.set=s(i,this.data),this.toggleOrientation=s(r.toggleOrientation,this.data),this.setPieces=s(r.setPieces,this.data),this.selectSquare=s(r.selectSquare,this.data,!0),this.apiMove=s(r.apiMove,this.data),this.playPremove=s(r.playPremove,this.data),this.cancelPremove=s(r.unsetPremove,this.data,!0),this.setCheck=s(r.setCheck,this.data,!0),this.cancelMove=s(function(e){r.cancelMove(e),c.cancel(e)}.bind(this),this.data,!0),this.stop=s(function(e){r.stop(e),c.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding=e,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),200))}.bind(this)}},{"./anim":3,"./board":5,"./configure":6,"./data":8,"./drag":9,"./fen":11}],8:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,minimalDom:!1,disableContextMenu:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){}}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,squareTarget:!1,centerPiece:!0,showGhost:!0,current:{}},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},capture:function(e,t){},select:function(e){}},drawable:{enabled:!1,shapes:[],current:{}}};return o(t,e||{}),t}},{"./configure":6,"./fen":11}],9:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function a(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),u=t.target;var n=e.selected,a=f.eventPosition(t),s=e.bounds(),c=d.getKeyAtDomPos(e,a,s),l=!!e.premovable.current;d.selectSquare(e,c);var h=e.selected===c;if(e.pieces[c]&&h&&d.isDraggable(e,c)){var p=o(e,s,c);e.draggable.current={previouslySelected:n,orig:c,piece:r(e.pieces[c]),rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(p.left+p.width/2),a[1]-(p.top+p.height/2)]:[0,0],bounds:s,started:e.draggable.autoDistance&&e.stats.dragged}}else l&&d.unsetPremove(e);i(e)}}function i(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?l(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&i(e)})}function s(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function c(e,t){var n=e.draggable,r=n.current?n.current.orig:null;if(r&&(!t||"touchend"!==t.type||u===t.target)){d.unsetPremove(e);var o=n.current.over;n.current.started&&(r!==o&&(e.movable.dropped=[r,o]),d.userMove(e,r,o)&&(e.stats.dragged=!0)),r!==n.current.previouslySelected||r!==o&&o||d.setSelected(e,null),n.current={}}}function l(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var u,d=e("./board"),f=e("./util");t.exports={start:a,move:s,end:c,cancel:l,processDrag:i}},{"./board":5,"./util":16}],10:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),f.cancelMove(e);var n=h.eventPosition(t),r=e.bounds(),a=f.getKeyAtDomPos(e,n,r);e.drawable.current={orig:a,epos:n,bounds:r,drawColor:(t.shiftKey&h.isRightButton(t))+(t.altKey?2:0)},o(e)}}function o(e){h.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=f.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function a(e,t){e.drawable.current.orig&&(e.drawable.current.epos=h.eventPosition(t))}function i(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&u(n,r),n.current={},e.render()}function s(e){e.drawable.current.orig&&(e.drawable.current={})}function c(e,t){0!==t.button||t.shiftKey||(e.drawable.shapes=[],e.render())}function l(e){return function(t){return!e(t)}}function u(e,t){var n=e.current.drawColor,r=function(e){return e.drawColor===n&&e.orig===t&&!e.dest},o=e.shapes.filter(r).length>0;o?e.shapes=e.shapes.filter(l(r)):e.shapes.push({drawColor:n,orig:t})}function d(e,t,n){var r=e.current.drawColor,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},a=e.shapes.filter(o).length>0;a?e.shapes=e.shapes.filter(l(o)):e.shapes.push({drawColor:r,orig:t,dest:n})}var f=e("./board"),h=e("./util");t.exports={start:r,move:a,end:i,cancel:s,clear:c,processDraw:o}},{"./board":5,"./util":16}],11:[function(e,t,n){function r(e){"start"===e&&(e=i);var t={};return e.replace(/ .+$/,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[a.pos2key([r,8-n])]={role:s[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},a.invRanks.map(function(t){return a.ranks.map(function(n){var r=e[a.pos2key([n,t])];if(r){var o=c[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var a=e("./util"),i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",s={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},c={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:i,read:r,write:o}},{"./util":16}],12:[function(e,t,n){var r,o=function(){r=new Date},a=function(){r=null},i=function(){if(!r)return 0;var e=new Date-r;return r=null,e};t.exports={start:o,cancel:a,stop:i}},{}],13:[function(e,t,n){function r(e,t){var n=new a(t);return o.render(e,i(n)),s(n)}var o=e("mithril"),a=e("./ctrl"),i=e("./view"),s=e("./api");t.exports=r,t.exports.controller=a,t.exports.view=i,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":3,"./api":4,"./board":5,"./configure":6,"./ctrl":7,"./drag":9,"./fen":11,"./util":16,"./view":17,mithril:18}],14:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,a){return r(t,o)<2&&("white"===e?a===n+1||2>=n&&a===n+2&&t===o:a===n-1||n>=7&&a===n-2&&t===o)}function a(e,t,n,o){var a=r(e,n),i=r(t,o);return 1===a&&2===i||2===a&&1===i}function i(e,t,n,o){return r(e,n)===r(t,o)}function s(e,t,n,r){return e===n||t===r}function c(e,t,n,r){return i(e,t,n,r)||s(e,t,n,r)}function l(e,t,n,o,a,i,s){return r(o,i)<2&&r(a,s)<2||n&&a===s&&a===("white"===e?1:8)&&(5===o&&(3===i||7===i)||f.containsX(t,i))}function u(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],h=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=a;break;case"bishop":r=i;break;case"rook":r=s;break;case"queen":r=c;break;case"king":r=l.bind(null,d.color,u(e,d.color),n)}return f.allPos.filter(function(e){return(h[0]!==e[0]||h[1]!==e[1])&&r(h[0],h[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":16}],15:[function(e,t,n){function r(e){return(e?2:4)/512*h.width}function o(e){return(e?7:10)/512*h.width}function a(e){return e?.5:1}function i(){return 24/512*h.width}function s(e){var t=h.width/8;return[(e[0]-.5)*t,(8.5-e[1])*t]}function c(e,t,n){var o=s(t),i=r(n),c=h.width/16;return{tag:"circle",attrs:{key:n?"current":t,stroke:m[e],"stroke-width":i,fill:"none",opacity:a(n),cx:o[0],cy:o[1],r:c-i/2-e*i*1.5}}}function l(e,t,n,r){var c=i(),l=s(t),u=s(n),d=u[0]-l[0],f=u[1]-l[1],h=Math.atan2(f,d),p=Math.cos(h)*c,g=Math.sin(h)*c;return{tag:"line",attrs:{key:r?"current":t+n,stroke:m[e],"stroke-width":o(r),"stroke-linecap":"round","marker-end":"url(#arrowhead"+e+")",opacity:a(r),x1:l[0],y1:l[1],x2:u[0]-p,y2:u[1]-g}}}function u(e){return{tag:"defs",children:[e.map(function(e){return{tag:"marker",attrs:{id:"arrowhead"+e,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:m[e]}}]}})]}}function d(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function f(e,t){return function(n){return n.orig&&n.dest?l(n.drawColor,d(p(n.orig),e),d(p(n.dest),e),t):n.orig?c(n.drawColor,d(p(n.orig),e),t):void 0}}var h,p=(e("mithril"),e("./util").key2pos),m=["#15781B","#882020","#003088","#E68F00"],g=m.map(function(e,t){return t});t.exports=function(e){if(e.data.bounds){var t=e.data.drawable;if((t.shapes.length||t.current.orig)&&(h||(h=e.data.bounds()),h.width===h.height)){var n=g.filter(function(e){return t.current&&t.current.dest&&t.current.drawColor===e||t.shapes.filter(function(t){return t.dest&&t.drawColor===e}).length});return{tag:"svg",children:[u(n),t.shapes.map(f(e.data.orientation)),f(e.data.orientation,!0)(t.current)]}}}}},{"./util":16,mithril:18}],16:[function(e,t,n){function r(e){return y[e[0]-1]+e[1]}function o(e){return[y.indexOf(e[0])+1,parseInt(e[1])]}function a(e){return y[7-y.indexOf(e[0])]+(9-parseInt(e[1]))}function i(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function s(e){return"white"===e?"black":"white"}function c(e,t){return e&&(e[0]===t||e[1]===t)}function l(e,t){return e&&-1!==e.indexOf(t)}function u(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function d(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function f(){return b||(b=d()),b}function h(e){return"translate3d("+e[0]+"px,"+e[1]+"px,0)"}function p(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function m(e,t){return e.bind.apply(e,[null].concat(t))}function g(){return m(arguments[0],Array.prototype.slice.call(arguments,1))}function v(e){return 2===e.buttons||2===e.button}var b,y="abcdefgh".split(""),k=[1,2,3,4,5,6,7,8],w=[8,7,6,5,4,3,2,1],x=function(){var e=[];return w.forEach(function(t){k.forEach(function(n){e.push([n,t])})}),e}(),T=x.slice().reverse(),C=x.map(r);t.exports={files:y,ranks:k,invRanks:w,allPos:x,invPos:T,allKeys:C,pos2key:r,key2pos:o,invertKey:a,classSet:i,opposite:s,translate:h,contains2:c,containsX:l,distance:u,eventPosition:p,partialApply:m,partial:g,transformProp:f,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:v}},{}],17:[function(e,t,n){function r(e){return["cg-piece",e.role,e.color].join(" ")}function o(e,t,n){var o={style:{},"class":r(n)},a=e.data.draggable.current;if(a.orig===t&&a.started)o.style[g.transformProp()]=g.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o["class"]+=" dragging";else if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[g.transformProp()]=g.translate(i[1]))}return{tag:"div",attrs:o}}function a(e){return{tag:"div",attrs:{"class":r(e)+" ghost"}}}function i(e,t,n){var r=g.files[t[0]-1],i=t[1],s=r+i,c=e.data.pieces[s],l=e.data.highlight.dragOver&&e.data.draggable.current.over===s,u={"class":"cg-square "+g.classSet({selected:e.data.selected===s,check:e.data.highlight.check&&e.data.check===s,"last-move":e.data.highlight.lastMove&&g.contains2(e.data.lastMove,s),"move-dest":(l||e.data.movable.showDests)&&g.containsX(e.data.movable.dests[e.data.selected],s),"premove-dest":(l||e.data.premovable.showDests)&&g.containsX(e.data.premovable.dests,s),"current-premove":g.contains2(e.data.premovable.current,s),"drag-over":l,oc:!!c,exploding:e.vm.exploding&&-1!==e.vm.exploding.indexOf(s)}),style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};e.data.coordinates&&(t[1]===(n?1:8)&&(u["data-coord-x"]=r),t[0]===(n?8:1)&&(u["data-coord-y"]=i));var d=[];return c&&(d.push(o(e,s,c)),e.data.draggable.current.orig===s&&e.data.draggable.showGhost&&d.push(a(c))),{tag:"div",attrs:u,children:d}}function s(e,t){var n=g.key2pos(t.over),r="white"===e.data.orientation?n[0]:9-n[0],o="white"===e.data.orientation?n[1]:9-n[1];return{tag:"div",attrs:{id:"cg-square-target",style:{width:t.bounds.width/4+"px",height:t.bounds.height/4+"px",left:(r-1.5)*t.bounds.width/8+"px",top:(7.5-o)*t.bounds.height/8+"px"}}}}function c(e){return{tag:"div",attrs:{"class":"cg-square fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:[{tag:"div",attrs:{"class":r(e.piece)}}]}}function l(e,t){var n=[];e.data.lastMove&&e.data.lastMove.forEach(function(e){var r=g.key2pos(e);n.push({tag:"div",attrs:{"class":"cg-square last-move",style:{left:12.5*(t?r[0]-1:8-r[0])+"%",bottom:12.5*(t?r[1]-1:8-r[1])+"%"}}})});for(var o=Object.keys(e.data.pieces),a=0,i=o.length;i>a;a++){var s=o[a],c=g.key2pos(s),l={style:{left:12.5*(t?c[0]-1:8-c[0])+"%",bottom:12.5*(t?c[1]-1:8-c[1])+"%"},"class":r(e.data.pieces[s])};if(e.data.animation.current.anims){var u=e.data.animation.current.anims[s];u&&(l.style[g.transformProp()]=g.translate(u[1]))}n.push({tag:"div",attrs:l})}return n}function u(e){var t="white"===e.data.orientation;if(e.data.minimalDom)return l(e,t);for(var n=t?g.allPos:g.invPos,r=[],o=0,a=n.length;a>o;o++)r.push(i(e,n[o],t));return e.data.draggable.current.over&&e.data.draggable.squareTarget&&r.push(s(e,e.data.draggable.current)),e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){r.push(c(e))}),e.data.drawable.enabled&&r.push(v(e)),r}function d(e,t,n){return function(r){e.drawable.enabled&&(r.shiftKey||g.isRightButton(r))?n(e,r):e.viewOnly||t(e,r)}}function f(e,t,n){var r=e.data,o=d(r,p.start,m.start),a=d(r,p.move,m.move),i=d(r,p.end,m.end),s=g.partial(m.clear,r),c=["touchstart","mousedown"],l=["touchmove","mousemove"],u=["touchend","mouseup"];c.forEach(function(e){t.addEventListener(e,o)}),l.forEach(function(e){document.addEventListener(e,a)}),u.forEach(function(e){document.addEventListener(e,i)}),t.addEventListener("mousedown",s),n.onunload=function(){c.forEach(function(e){t.removeEventListener(e,o)}),l.forEach(function(e){document.removeEventListener(e,a)}),u.forEach(function(e){document.removeEventListener(e,i)}),t.removeEventListener("mousedown",s)}}function h(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||((!e.data.viewOnly||e.data.drawable.enabled)&&f(e,t,r),e.data.render=function(){b.render(t,u(e))},e.data.renderRAF=function(){g.requestAnimationFrame(e.data.render)},e.data.bounds=t.getBoundingClientRect.bind(t),e.data.element=t,e.data.render())}},children:[]}}var p=e("./drag"),m=e("./draw"),g=e("./util"),v=e("./svg"),b=e("mithril");t.exports=function(e){return{tag:"div",attrs:{config:function(t,n){n||t.addEventListener("contextmenu",function(t){return e.data.disableContextMenu||e.data.drawable.enabled?(t.preventDefault(),!1):void 0})},"class":["cg-board-wrap",e.data.viewOnly?"view-only":"manipulable",e.data.minimalDom?"minimal-dom":"full-dom"].join(" ")},children:[h(e)]}}},{"./drag":9,"./draw":10,"./svg":15,"./util":16,mithril:18}],18:[function(t,n,r){var o=function a(e,t){function n(e){P=e.document,j=e.location,S=e.cancelAnimationFrame||e.clearTimeout,R=e.requestAnimationFrame||e.setTimeout}function r(){var e,t=[].slice.call(arguments),n=!(null==t[1]||_.call(t[1])!==N||"tag"in t[1]||"view"in t[1]||"subtree"in t[1]),r=n?t[1]:{},o="class"in r?"class":"className",a={tag:"div",attrs:{}},i=[];if(_.call(t[0])!=q)throw new Error("selector in m(selector, attrs, children) should be a string");for(;e=$.exec(t[0]);)if(""===e[1]&&e[2])a.tag=e[2];else if("#"===e[1])a.attrs.id=e[2];else if("."===e[1])i.push(e[2]);else if("["===e[3][0]){var s=I.exec(e[3]);a.attrs[s[1]]=s[3]||(s[2]?"":!0)}var c=t.slice(n?2:1);a.children=1===c.length&&_.call(c[0])===D?c[0]:c;for(var l in r)r.hasOwnProperty(l)&&(l===o&&null!=r[l]&&""!==r[l]?(i.push(r[l]),a.attrs[l]=""):a.attrs[l]=r[l]);return i.length>0&&(a.attrs[o]=i.join(" ")),a}function o(e,n,a,l,d,f,h,p,m,g,v){try{(null==d||null==d.toString())&&(d="")}catch(b){d=""}if("retain"===d.subtree)return f;var y=_.call(f),k=_.call(d);if(null==f||y!==k){if(null!=f)if(a&&a.nodes){var w=p-l,x=w+(k===D?d:f.nodes).length;c(a.nodes.slice(w,x),a.slice(w,x))}else f.nodes&&c(f.nodes,f);f=new d.constructor,f.tag&&(f={}),f.nodes=[]}if(k===D){for(var T=0,C=d.length;C>T;T++)_.call(d[T])===D&&(d=d.concat.apply([],d),T--,C=d.length);for(var E=[],O=f.length===d.length,M=0,A=1,j=2,R=3,S={},$=!1,T=0;T<f.length;T++)f[T]&&f[T].attrs&&null!=f[T].attrs.key&&($=!0,S[f[T].attrs.key]={action:A,index:T});for(var I=0,T=0,C=d.length;C>T;T++)if(d[T]&&d[T].attrs&&null!=d[T].attrs.key){for(var K=0,C=d.length;C>K;K++)d[K]&&d[K].attrs&&null==d[K].attrs.key&&(d[K].attrs.key="__mithril__"+I++);break}if($){var B=!1;if(d.length!=f.length)B=!0;else for(var G,U,T=0;G=f[T],U=d[T];T++)if(G.attrs&&U.attrs&&G.attrs.key!=U.attrs.key){B=!0;break}if(B){for(var T=0,C=d.length;C>T;T++)if(d[T]&&d[T].attrs&&null!=d[T].attrs.key){var z=d[T].attrs.key;S[z]=S[z]?{action:R,index:T,from:S[z].index,element:f.nodes[S[z].index]||P.createElement("div")}:{action:j,index:T}}var X=[];for(var W in S)X.push(S[W]);var J=X.sort(i),Y=new Array(f.length);Y.nodes=f.nodes.slice();for(var V,T=0;V=J[T];T++){if(V.action===A&&(c(f[V.index].nodes,f[V.index]),Y.splice(V.index,1)),V.action===j){var Q=P.createElement("div");Q.key=d[V.index].attrs.key,e.insertBefore(Q,e.childNodes[V.index]||null),Y.splice(V.index,0,{attrs:{key:d[V.index].attrs.key},nodes:[Q]}),Y.nodes[V.index]=Q}V.action===R&&(e.childNodes[V.index]!==V.element&&null!==V.element&&e.insertBefore(V.element,e.childNodes[V.index]||null),Y[V.index]=f[V.from],Y.nodes[V.index]=V.element)}f=Y}}for(var T=0,Z=0,C=d.length;C>T;T++){var te=o(e,n,f,p,d[T],f[Z],h,p+M||M,m,g,v);te!==t&&(te.nodes.intact||(O=!1),M+=te.$trusted?(te.match(/<[^\/]|\>\s*[^<]/g)||[0]).length:_.call(te)===D?te.length:1,f[Z++]=te)}if(!O){for(var T=0,C=d.length;C>T;T++)null!=f[T]&&E.push.apply(E,f[T].nodes);for(var ne,T=0;ne=f.nodes[T];T++)null!=ne.parentNode&&E.indexOf(ne)<0&&c([ne],[f[T]]);d.length<f.length&&(f.length=d.length),f.nodes=E}}else if(null!=d&&k===N){for(var oe=[],ae=[];d.view;){var ie=d.view.$original||d.view,se="diff"==r.redraw.strategy()&&f.views?f.views.indexOf(ie):-1,ce=se>-1?f.controllers[se]:new(d.controller||H),z=d&&d.attrs&&d.attrs.key;if(d=0==re||f&&f.controllers&&f.controllers.indexOf(ce)>-1?d.view(ce):{tag:"placeholder"},"retain"===d.subtree)return f;z&&(d.attrs||(d.attrs={}),d.attrs.key=z),ce.onunload&&ee.push({controller:ce,handler:ce.onunload}),oe.push(ie),ae.push(ce)}if(!d.tag&&ae.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");d.attrs||(d.attrs={}),f.attrs||(f.attrs={});var le=Object.keys(d.attrs),ue=le.length>("key"in d.attrs?1:0);if((d.tag!=f.tag||le.sort().join()!=Object.keys(f.attrs).sort().join()||d.attrs.id!=f.attrs.id||d.attrs.key!=f.attrs.key||"all"==r.redraw.strategy()&&(!f.configContext||f.configContext.retain!==!0)||"diff"==r.redraw.strategy()&&f.configContext&&f.configContext.retain===!1)&&(f.nodes.length&&c(f.nodes),f.configContext&&typeof f.configContext.onunload===L&&f.configContext.onunload(),f.controllers))for(var ce,T=0;ce=f.controllers[T];T++)typeof ce.onunload===L&&ce.onunload({preventDefault:H});if(_.call(d.tag)!=q)return;var ne,de=0===f.nodes.length;if(d.attrs.xmlns?g=d.attrs.xmlns:"svg"===d.tag?g="http://www.w3.org/2000/svg":"math"===d.tag&&(g="http://www.w3.org/1998/Math/MathML"),de){if(ne=d.attrs.is?g===t?P.createElement(d.tag,d.attrs.is):P.createElementNS(g,d.tag,d.attrs.is):g===t?P.createElement(d.tag):P.createElementNS(g,d.tag),f={tag:d.tag,attrs:ue?s(ne,d.tag,d.attrs,{},g):d.attrs,children:null!=d.children&&d.children.length>0?o(ne,d.tag,t,t,d.children,f.children,!0,0,d.attrs.contenteditable?ne:m,g,v):d.children,nodes:[ne]},ae.length){f.views=oe,f.controllers=ae;for(var ce,T=0;ce=ae[T];T++)if(ce.onunload&&ce.onunload.$old&&(ce.onunload=ce.onunload.$old),re&&ce.onunload){var fe=ce.onunload;ce.onunload=H,ce.onunload.$old=fe}}f.children&&!f.children.nodes&&(f.children.nodes=[]),"select"===d.tag&&"value"in d.attrs&&s(ne,d.tag,{value:d.attrs.value},{},g),e.insertBefore(ne,e.childNodes[p]||null)}else ne=f.nodes[0],ue&&s(ne,d.tag,d.attrs,f.attrs,g),f.children=o(ne,d.tag,t,t,d.children,f.children,!1,0,d.attrs.contenteditable?ne:m,g,v),f.nodes.intact=!0,ae.length&&(f.views=oe,f.controllers=ae),h===!0&&null!=ne&&e.insertBefore(ne,e.childNodes[p]||null);if(typeof d.attrs.config===L){var he=f.configContext=f.configContext||{},pe=function(e,t){return function(){return e.attrs.config.apply(e,t)}};v.push(pe(d,[ne,!de,he,f]))}}else if(typeof d!=L){var E;0===f.nodes.length?(d.$trusted?E=u(e,p,d):(E=[P.createTextNode(d)],e.nodeName.match(F)||e.insertBefore(E[0],e.childNodes[p]||null)),f="string number boolean".indexOf(typeof d)>-1?new d.constructor(d):d,f.nodes=E):f.valueOf()!==d.valueOf()||h===!0?(E=f.nodes,m&&m===P.activeElement||(d.$trusted?(c(E,f),E=u(e,p,d)):"textarea"===n?e.value=d:m?m.innerHTML=d:((1===E[0].nodeType||E.length>1)&&(c(f.nodes,f),E=[P.createTextNode(d)]),e.insertBefore(E[0],e.childNodes[p]||null),E[0].nodeValue=d)),f=new d.constructor(d),f.nodes=E):f.nodes.intact=!0}return f}function i(e,t){return e.action-t.action||e.index-t.index}function s(e,t,n,r,o){for(var a in n){var i=n[a],s=r[a];if(a in r&&s===i)"value"===a&&"input"===t&&e.value!=i&&(e.value=i);else{r[a]=i;try{if("config"===a||"key"==a)continue;if(typeof i===L&&0===a.indexOf("on"))e[a]=d(i,e);else if("style"===a&&null!=i&&_.call(i)===N){for(var c in i)(null==s||s[c]!==i[c])&&(e.style[c]=i[c]);for(var c in s)c in i||(e.style[c]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i):"className"===a?e.setAttribute("class",i):e.setAttribute(a,i):a in e&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a&&"width"!==a&&"height"!==a?("input"!==t||e[a]!==i)&&(e[a]=i):e.setAttribute(a,i)}catch(l){if(l.message.indexOf("Invalid argument")<0)throw l}}}return r}function c(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&l(t[n])}0!=e.length&&(e.length=0)}function l(e){if(e.configContext&&typeof e.configContext.onunload===L&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers)for(var t,n=0;t=e.controllers[n];n++)typeof t.onunload===L&&t.onunload({
preventDefault:H});if(e.children)if(_.call(e.children)===D)for(var r,n=0;r=e.children[n];n++)l(r);else e.children.tag&&l(e.children)}function u(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=P.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function d(e,t){return function(n){n=n||event,r.redraw.strategy("diff"),r.startComputation();try{return e.call(t,n)}finally{oe()}}}function f(e){var t=G.indexOf(e);return 0>t?G.push(e)-1:t}function h(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function p(e,t){var n=function(){return(e.controller||H).apply(this,t)||this},r=function(n){return arguments.length>1&&(t=t.concat([].slice.call(arguments,1))),e.view.apply(e,t?[n].concat(t):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function m(){Q&&(Q(),Q=null);for(var e,t=0;e=X[t];t++)if(J[t]){var n=W[t].controller&&W[t].controller.$$args?[J[t]].concat(W[t].controller.$$args):[J[t]];r.render(e,W[t].view?W[t].view(J[t],n):"")}Z&&(Z(),Z=null),Y=null,V=new Date,r.redraw.strategy("diff")}function g(e){return e.slice(se[r.route.mode].length)}function v(e,t,n){ae={};var o=n.indexOf("?");-1!==o&&(ae=w(n.substr(o+1,n.length)),n=n.substr(0,o));var a=Object.keys(t),i=a.indexOf(n);if(-1!==i)return r.mount(e,t[a[i]]),!0;for(var s in t){if(s===n)return r.mount(e,t[s]),!0;var c=new RegExp("^"+s.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(c.test(n))return n.replace(c,function(){for(var n=s.match(/:[^\/]+/g)||[],o=[].slice.call(arguments,1,-2),a=0,i=n.length;i>a;a++)ae[n[a].replace(/:|\./g,"")]=decodeURIComponent(o[a]);r.mount(e,t[s])}),!0}}function b(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===r.route.mode&&t.search?w(t.search.slice(1)):{};t&&"A"!=t.nodeName.toUpperCase();)t=t.parentNode;r.route(t[r.route.mode].slice(se[r.route.mode].length),n)}}function y(){"hash"!=r.route.mode&&j.hash?j.hash=j.hash:e.scrollTo(0,0)}function k(e,n){var r={},o=[];for(var a in e){var i=n?n+"["+a+"]":a,s=e[a],c=_.call(s),l=null===s?encodeURIComponent(i):c===N?k(s,i):c===D?s.reduce(function(e,t){return r[i]||(r[i]={}),r[i][t]?e:(r[i][t]=!0,e.concat(encodeURIComponent(i)+"="+encodeURIComponent(t)))},[]).join("&"):encodeURIComponent(i)+"="+encodeURIComponent(s);s!==t&&o.push(l)}return o.join("&")}function w(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var t=e.split("&"),n={},r=0,o=t.length;o>r;r++){var a=t[r].split("="),i=decodeURIComponent(a[0]),s=2==a.length?decodeURIComponent(a[1]):null;null!=n[i]?(_.call(n[i])!==D&&(n[i]=[n[i]]),n[i].push(s)):n[i]=s}return n}function x(e){var n=f(e);c(e.childNodes,U[n]),U[n]=t}function T(e,t){var n=r.prop(t);return e.then(n),n.then=function(n,r){return T(e.then(n,r),t)},n}function C(e,t){function n(e){d=e||l,h.map(function(e){d===c&&e.resolve(f)||e.reject(f)})}function o(e,t,n,o){if((null!=f&&_.call(f)===N||typeof f===L)&&typeof e===L)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(i){r.deferred.onerror(i),f=i,n()}else o()}function a(){var l;try{l=f&&f.then}catch(h){return r.deferred.onerror(h),f=h,d=s,a()}o(l,function(){d=i,a()},function(){d=s,a()},function(){try{d===i&&typeof e===L?f=e(f):d===s&&"function"==typeof t&&(f=t(f),d=i)}catch(a){return r.deferred.onerror(a),f=a,n()}f===u?(f=TypeError(),n()):o(l,function(){n(c)},n,function(){n(d===i&&c)})})}var i=1,s=2,c=3,l=4,u=this,d=0,f=0,h=[];u.promise={},u.resolve=function(e){return d||(f=e,d=i,a()),this},u.reject=function(e){return d||(f=e,d=s,a()),this},u.promise.then=function(e,t){var n=new C(e,t);return d===c?n.resolve(f):d===l?n.reject(f):h.push(n),n.promise}}function E(e){return e}function O(n){if(!n.dataType||"jsonp"!==n.dataType.toLowerCase()){var r=new e.XMLHttpRequest;if(r.open(n.method,n.url,!0,n.user,n.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?n.onload({type:"load",target:r}):n.onerror({type:"error",target:r}))},n.serialize===JSON.stringify&&n.data&&"GET"!==n.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof n.config===L){var o=n.config(r,n);null!=o&&(r=o)}var a="GET"!==n.method&&n.data?n.data:"";if(a&&_.call(a)!=q&&a.constructor!=e.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var i="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),s=P.createElement("script");e[i]=function(r){s.parentNode.removeChild(s),n.onload({type:"load",target:{responseText:r}}),e[i]=t},s.onerror=function(r){return s.parentNode.removeChild(s),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[i]=t,!1},s.onload=function(e){return!1},s.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+i+"&"+k(n.data||{}),P.body.appendChild(s)}function M(e,t,n){if("GET"===e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=k(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function A(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var P,j,R,S,N="[object Object]",D="[object Array]",q="[object String]",L="function",_={}.toString,$=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,I=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,F=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,H=function(){};n(e);var K,B={appendChild:function(e){K===t&&(K=P.createElement("html")),P.documentElement&&P.documentElement!==e?P.replaceChild(e,P.documentElement):P.appendChild(e),this.childNodes=P.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},G=[],U={};r.render=function(e,n,r){var a=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i=f(e),s=e===P,l=s||e===P.documentElement?B:e;s&&"html"!=n.tag&&(n={tag:"html",attrs:{},children:n}),U[i]===t&&c(l.childNodes),r===!0&&x(e),U[i]=o(l,null,t,t,n,U[i],!1,0,null,t,a);for(var u=0,d=a.length;d>u;u++)a[u]()},r.trust=function(e){return e=new String(e),e.$trusted=!0,e},r.prop=function(e){return(null!=e&&_.call(e)===N||typeof e===L)&&typeof e.then===L?T(e):h(e)};var z,X=[],W=[],J=[],Y=null,V=0,Q=null,Z=null,ee=[],te=16;r.component=function(e){return p(e,[].slice.call(arguments,1))},r.mount=r.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=X.indexOf(e);0>n&&(n=X.length);for(var o,a=!1,i={preventDefault:function(){a=!0,Q=Z=null}},s=0;o=ee[s];s++)o.handler.call(o.controller,i),o.controller.onunload=null;if(a)for(var o,s=0;o=ee[s];s++)o.controller.onunload=o.handler;else ee=[];if(J[n]&&typeof J[n].onunload===L&&J[n].onunload(i),!a){r.redraw.strategy("all"),r.startComputation(),X[n]=e,arguments.length>2&&(t=subcomponent(t,[].slice.call(arguments,2)));var c=z=t=t||{controller:function(){}},l=t.controller||H,u=new l;return c===z&&(J[n]=u,W[n]=t),oe(),J[n]}};var ne=!1;r.redraw=function(t){ne||(ne=!0,Y&&t!==!0?(R===e.requestAnimationFrame||new Date-V>te)&&(Y>0&&S(Y),Y=R(m,te)):(m(),Y=R(function(){Y=null},te)),ne=!1)},r.redraw.strategy=r.prop();var re=0;r.startComputation=function(){re++},r.endComputation=function(){re=Math.max(re-1,0),0===re&&r.redraw()};var oe=function(){"none"==r.redraw.strategy()?(re--,r.redraw.strategy("diff")):r.endComputation()};r.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var ae,ie,se={pathname:"",hash:"#",search:"?"},ce=H,le=!1;return r.route=function(){if(0===arguments.length)return ie;if(3===arguments.length&&_.call(arguments[1])===q){var t=arguments[0],n=arguments[1],o=arguments[2];ce=function(e){var a=ie=g(e);if(!v(t,o,a)){if(le)throw new Error("Ensure the default route matches one of the routes defined in m.route");le=!0,r.route(n,!0),le=!1}};var a="hash"===r.route.mode?"onhashchange":"onpopstate";e[a]=function(){var e=j[r.route.mode];"pathname"===r.route.mode&&(e+=j.search),ie!=g(e)&&ce(e)},Q=y,e[a]()}else if(arguments[0].addEventListener||arguments[0].attachEvent){var i=arguments[0],s=(arguments[1],arguments[2],arguments[3]);i.href=("pathname"!==r.route.mode?j.pathname:"")+se[r.route.mode]+s.attrs.href,i.addEventListener?(i.removeEventListener("click",b),i.addEventListener("click",b)):(i.detachEvent("onclick",b),i.attachEvent("onclick",b))}else if(_.call(arguments[0])===q){var c=ie;ie=arguments[0];var l=arguments[1]||{},u=ie.indexOf("?"),d=u>-1?w(ie.slice(u+1)):{};for(var f in l)d[f]=l[f];var h=k(d),p=u>-1?ie.slice(0,u):ie;h&&(ie=p+(-1===p.indexOf("?")?"?":"&")+h);var m=(3===arguments.length?arguments[2]:arguments[1])===!0||c===arguments[0];e.history.pushState?(Q=y,Z=function(){e.history[m?"replaceState":"pushState"](null,P.title,se[r.route.mode]+ie)},ce(se[r.route.mode]+ie)):(j[r.route.mode]=ie,ce(se[r.route.mode]+ie))}},r.route.param=function(e){if(!ae)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return ae[e]},r.route.mode="search",r.route.buildQueryString=k,r.route.parseQueryString=w,r.deferred=function(){var e=new C;return e.promise=T(e.promise),e},r.deferred.onerror=function(e){if("[object Error]"===_.call(e)&&!e.constructor.toString().match(/ Error/))throw e},r.sync=function(e){function t(e,t){return function(r){return i[e]=r,t||(n="reject"),0===--a&&(o.promise(i),o[n](i)),r}}var n="resolve",o=r.deferred(),a=e.length,i=new Array(a);if(e.length>0)for(var s=0;s<e.length;s++)e[s].then(t(s,!0),t(s,!1));else o.resolve([]);return o.promise},r.request=function(e){e.background!==!0&&r.startComputation();var t=new C,n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),o=e.serialize=n?E:e.serialize||JSON.stringify,a=e.deserialize=n?E:e.deserialize||JSON.parse,i=n?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=A(e.url,e.data),e=M(e,e.data,o),e.onload=e.onerror=function(n){try{n=n||event;var o=("load"===n.type?e.unwrapSuccess:e.unwrapError)||E,s=o(a(i(n.target,e)),n.target);if("load"===n.type)if(_.call(s)===D&&e.type)for(var c=0;c<s.length;c++)s[c]=new e.type(s[c]);else e.type&&(s=new e.type(s));t["load"===n.type?"resolve":"reject"](s)}catch(n){r.deferred.onerror(n),t.reject(n)}e.background!==!0&&r.endComputation()},O(e),t.promise=T(t.promise,e.initialValue),t.promise},r.deps=function(t){return n(e=t||e),e},r.deps.factory=a,r}("undefined"!=typeof window?window:{});"undefined"!=typeof n&&null!==n&&n.exports?n.exports=o:"function"==typeof e&&e.amd&&e(function(){return o})},{}],19:[function(e,t,n){var r=e("mithril"),o=e("./socket"),a=e("./variant"),i=e("./hookRepo"),s=e("./seekRepo"),c=e("./store"),l=e("./xhr"),u=e("chessground").util;t.exports=function(e){this.data=e.data,this.playban=e.playban,this.currentGame=e.currentGame,i.initAll(this),s.initAll(this),this.socket=new o(e.socketSend,this),this.vm={tab:c.tab.get(),mode:c.mode.get(),sort:c.sort.get(),filterOpen:!1,stepHooks:this.data.hooks.slice(0),stepping:!1,redirecting:!1};var t,n=function(){this.vm.stepHooks=this.data.hooks.slice(0),"real_time"===this.vm.tab&&r.redraw()}.bind(this);this.flushHooks=function(e){clearTimeout(t),e?n():(this.vm.stepping=!0,"real_time"===this.vm.tab&&r.redraw(),setTimeout(function(){this.vm.stepping=!1,n()}.bind(this),500)),t=d()}.bind(this);var d=u.partial(setTimeout,this.flushHooks,8e3);d(),this.setTab=function(e){"seeks"===e&&e!==this.vm.tab&&l.seeks().then(this.setSeeks),this.vm.tab=c.tab.set(e),this.vm.filterOpen=!1}.bind(this),this.setMode=function(e){this.vm.mode=c.mode.set(e),this.vm.filterOpen=!1}.bind(this),this.setSort=function(e){this.vm.sort=c.sort.set(e)}.bind(this),this.toggleFilter=function(){this.vm.filterOpen=!this.vm.filterOpen}.bind(this),this.setFilter=function(e){this.data.filter=e,this.flushHooks(!0),"real_time"!==this.vm.tab&&r.redraw()}.bind(this),this.clickHook=function(e){var t=i.find(this,e);!t||t.disabled||this.vm.stepping||this.vm.redirecting||("cancel"===t.action||a.confirm(t.variant))&&this.socket.send(t.action,t.id)}.bind(this),this.clickSeek=function(e){var t=s.find(this,e);t&&!this.vm.redirecting&&("cancelSeek"===t.action||a.confirm(t.variant))&&this.socket.send(t.action,t.id)}.bind(this),this.setSeeks=function(e){this.data.seeks=e,s.initAll(this)}.bind(this),this.gameActivity=function(e){this.data.nowPlaying.filter(function(t){return t.gameId===e}).length&&l.nowPlaying().then(function(e){this.data.nowPlaying=e,this.startWatching()}.bind(this))}.bind(this);var f=[];this.startWatching=function(){var e=this.data.nowPlaying.map(function(e){return e.gameId}).filter(function(e){return-1===f.indexOf(e)});e.length&&(setTimeout(function(){this.socket.send("startWatching",e.join(" "))}.bind(this),2e3),e.forEach(f.push.bind(f)))}.bind(this),this.startWatching(),this.setRedirecting=function(){this.vm.redirecting=!0,setTimeout(function(){this.vm.redirecting=!1}.bind(this),2e3)}.bind(this),this.trans=function(t){var n=e.i18n[t]||t;return Array.prototype.slice.call(arguments,1).forEach(function(e){n=n.replace("%s",e)}),n},this.playban&&setTimeout(location.reload,1e3*this.playban.remainingSeconds)}},{"./hookRepo":21,"./seekRepo":22,"./socket":23,"./store":24,"./variant":25,"./xhr":35,chessground:13,mithril:18}],20:[function(e,t,n){t.exports=function(e,t){var n=e.data.filter,r=[],o=0,a=[];return t.forEach(function(e){if("cancel"===e.action)a.push(e);else if(!$.fp.contains(n.variant,e.variant.key)||!$.fp.contains(n.mode,e.mode)||!$.fp.contains(n.speed,e.speed)||n.rating&&(!e.rating||e.rating<n.rating[0]||e.rating>n.rating[1]))o++;else{var t=e.mode+e.variant.key+e.time+e.rating;$.fp.contains(r,t)||a.push(e),r.push(t)}}),{visible:a,hidden:o}}},{}],21:[function(e,t,n){function r(e,t){return e.rating>t.rating?-1:1}function o(e,t){return e.time<t.time?-1:1}function a(e,t){t.sort("time"===e.vm.sort?o:r)}function i(e){e.action=e.uid===lichess.socket.settings.params.sri?"cancel":"join"}function s(e){e.data.hooks.forEach(i)}t.exports={init:i,initAll:s,sort:a,add:function(e,t){i(t),e.data.hooks.push(t)},remove:function(e,t){e.data.hooks=e.data.hooks.filter(function(e){return e.id!==t}),e.vm.stepHooks.forEach(function(e){e.id===t&&(e.disabled=!0)})},syncIds:function(e,t){e.data.hooks=e.data.hooks.filter(function(e){return-1!==t.indexOf(e.id)})},find:function(e,t){return e.data.hooks.filter(function(e){return e.id===t})[0]}}},{}],22:[function(e,t,n){function r(e,t){return e.rating>t.rating?-1:1}function o(e){e.data.seeks.sort(r)}function a(e){e.data.seeks.forEach(function(t){t.action=e.data.me&&t.username===e.data.me.username?"cancelSeek":"joinSeek"}),o(e)}t.exports={initAll:a,sort:o,find:function(e,t){return e.data.seeks.filter(function(e){return e.id===t})[0]}}},{}],23:[function(e,t,n){var r=e("mithril"),o=e("./xhr"),a=e("./hookRepo");t.exports=function(e,t){this.send=e;var n={hook_add:function(e){a.add(t,e),"cancel"===e.action&&t.flushHooks(!0),"real_time"===t.vm.tab&&r.redraw()},hook_remove:function(e){a.remove(t,e),"real_time"===t.vm.tab&&r.redraw()},hook_list:function(e){a.syncIds(t,e),"real_time"===t.vm.tab&&r.redraw()},reload_seeks:function(){"seeks"===t.vm.tab&&o.seeks().then(t.setSeeks)}};this.receive=function(e,t){return n[e]?(n[e](t),!0):!1}.bind(this)}},{"./hookRepo":21,"./xhr":35,mithril:18}],24:[function(e,t,n){function r(e){return{set:function(t){return t=e.fix(t),lichess.storage.set(e.key,t),t},get:function(){return e.fix(lichess.storage.get(e.key))}}}var o={key:"lichess.lobby.tab",fix:function(e){return-1===["real_time","seeks","now_playing"].indexOf(e)&&(e="real_time"),e}},a={key:"lichess.lobby.mode",fix:function(e){return-1===["list","chart"].indexOf(e)&&(e="list"),e}},i={key:"lichess.lobby.sort",fix:function(e){return-1===["rating","time"].indexOf(e)&&(e="rating"),e}};t.exports={tab:r(o),mode:r(a),sort:r(i)}},{}],25:[function(e,t,n){function r(e){return"lobby.variant."+e}var o={chess960:"This is a Chess960 game!\n\nThe starting position of the pieces on the players' home ranks is randomized.\nRead more: http://wikipedia.org/wiki/Chess960\n\nDo you want to play Chess960?",kingOfTheHill:"This is a King of the Hill game!\n\nThe game can be won by bringing the king to the center.\nRead more: http://lichess.org/king-of-the-hill",threeCheck:"This is a Three-check game!\n\nThe game can be won by checking the opponent 3 times.\nRead more: http://en.wikipedia.org/wiki/Three-check_chess",antichess:"This is an antichess chess game!\n\n If you can take a piece, you must. The game can be won by losing all your pieces.",atomic:"This is an atomic chess game!\n\nCapturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.",horde:"This is a horde chess game!\n\nWhite must take all black pawns to win. Black must checkmate white king."};t.exports={confirm:function(e){return Object.keys(o).every(function(t){var n=o[t];if(e.key!==t||lichess.storage.get(r(t)))return!0;var a=confirm(n);return a&&lichess.storage.set(r(t),1),a})}}},{}],26:[function(e,t,n){function r(e,t){return a("tr",{key:t.id,title:"joinSeek"===t.action?e.trans("joinTheGame")+" - "+t.perf.name:e.trans("cancel"),"data-id":t.id,"class":"seek "+("joinSeek"===t.action?"join":"cancel")},i([a("span",{"class":"is is2 color-icon "+(t.color||"random")}),t.rating?a("a.ulink",{href:"/@/"+t.username},t.username):"Anonymous",t.rating?t.rating:"",t.days?e.trans(1===t.days?"oneDay":"nbDays",t.days):"∞",[a("span",{"class":"varicon","data-icon":t.perf.icon}),e.trans(1===t.mode?"rated":"casual")]]))}function o(e){return e.data.me&&e.data.seeks.length<8?a("div.create",a("a.button",{href:"/?time=correspondence#hook"},e.trans("createAGame"))):void 0}var a=e("mithril"),i=e("./util").tds,s=e("chessground").util;t.exports=function(e){return[a("table.table_wrap",[a("thead",a("tr",[a("th"),a("th",e.trans("player")),a("th",e.trans("rating")),a("th",e.trans("time")),a("th",e.trans("mode"))])),a("tbody",{onclick:function(t){var n=t.target;if(!n.classList.contains("ulink"))do if(n=n.parentNode,"TR"===n.nodeName)return e.data.me?e.clickSeek(n.getAttribute("data-id")):void(confirm(e.trans("youNeedAnAccountToDoThat"))&&(location.href="/signup"));while("TABLE"!==n.nodeName)}},e.data.seeks.map(s.partial(r,e)))]),o(e)]}},{"./util":34,chessground:13,mithril:18}],27:[function(e,t,n){var r=e("mithril"),o=e("./tabs"),a=e("./realTime/main"),i=e("./correspondence"),s=e("./playing");t.exports=function(e){var t;if(!e.playban&&!e.currentGame){switch(e.vm.tab){case"real_time":t=a(e);break;case"seeks":t=i(e);break;case"now_playing":t=s(e)}return[r("div.tabs",o(e)),r("div.lobby_box",t)]}}},{"./correspondence":26,"./playing":28,"./realTime/main":32,"./tabs":33,mithril:18}],28:[function(e,t,n){function r(e){var t=moment().add(e.secondsLeft,"seconds");return o("time.moment-from-now",{datetime:t.format()},t.fromNow())}var o=e("mithril"),a=o("div.cg-board-wrap",o("div.cg-board"));t.exports=function(e){return o("div#now_playing",e.data.nowPlaying.map(function(t){return o("a",{key:t.gameId,href:"/"+t.fullId,"class":t.isMyTurn?"my_turn":""},[o("span",{"class":"mini_board is2d",config:function(e,n,r){var o=t.lastMove,a={coordinates:!1,viewOnly:!0,minimalDom:!0,orientation:t.color,fen:t.fen,lastMove:o?[o[0]+o[1],o[2]+o[3]]:[]};r.ground?r.ground.set(a):r.ground=Chessground(e,a)}},a),o("span.meta",[t.opponent.ai?e.trans("aiNameLevelAiLevel","Stockfish",t.opponent.ai):t.opponent.username,o("span.indicator",t.isMyTurn?t.secondsLeft?r(t):e.trans("yourTurn"):o.trust("&nbsp;"))])])}))}},{mithril:18}],29:[function(e,t,n){function r(e){return e+"px"}function o(e){return Math.log(e/150+1)}function a(e){var t,n=Math.max(1e3,Math.min(2200,e||1500)),r=.4;return t=1500==n?r:n>1500?r+o(n-1500)/o(1300)*2*r:r-o(1500-n)/o(500)*r,Math.round(489*t)}function i(e){function t(e){return Math.log((e-30)/200+1)}var n=2e3;return Math.round(t(Math.min(n,e||n))/t(n)*489)}function s(e,t){var n=Math.max(0,a(t.rating)-7),o=Math.max(0,i(t.time)-4),s=["plot new",t.mode?"rated":"casual","cancel"===t.action?"cancel":""].join(" ");return d("span",{id:t.id,key:t.id,"class":s,"data-icon":t.perf.icon,style:{bottom:r(n),left:r(o)},config:function(n,r,o){r||($(n).powerTip({intentPollInterval:100,fadeInTime:0,fadeOutTime:0,placement:t.rating>2200?"se":"ne",mouseOnToPopup:!0,closeDelay:200,popupId:"hook"}).data("powertipjq",$(c(e,t))),o.onunload=function(){$(n).data("powertipjq",null),$.powerTip.destroy(n)},setTimeout(function(){n.classList.remove("new")},20))}})}function c(e,t){var n="";return t.rating?(n+='<a class="opponent" href="/@/'+t.username+'">'+t.username.substr(0,14)+"</a>",n+='<span class="rating">'+t.rating+"</span>"):n+='<span class="opponent anon">Anonymous</span>',n+='<span class="clock">'+t.clock+"</span>",n+='<span class="mode"><span class="varicon" data-icon="'+t.perf.icon+'"></span>'+e.trans(t.mode?"rated":"casual")+"</span>",n+='<span class="is is2 color-icon '+(t.color||"random")+'"></span>'}function l(){return[1,2,3,5,7,10,15,20,30].map(function(e){var t=i(60*e);return[d("span",{"class":"x label",style:{left:r(t)}},e),d("div",{"class":"grid vert",style:{width:r(t+7)}})]})}function u(){return[1e3,1200,1400,1500,1600,1800,2e3].map(function(e){var t=a(e);return[d("span",{"class":"y label",style:{bottom:r(t+5)}},e),d("div",{"class":"grid horiz",style:{height:r(t+4)}})]})}var d=e("mithril"),f=e("chessground").util;t.exports={toggle:function(e){return d("span",{"data-hint":e.trans("list"),"class":"mode_toggle hint--bottom",onclick:f.partial(e.setMode,"list")},d("span.chart[data-icon=?]"))},render:function(e,t){return d("div.hooks_chart",[d("div.canvas",{onclick:function(t){t.target.classList.contains("plot")&&e.clickHook(t.target.id)}},t.map(f.partial(s,e))),u(),l()])}}},{chessground:13,mithril:18}],30:[function(e,t,n){function r(e,t){function n(e){a.find("input").val(e[0]+"-"+e[1]),a.siblings(".range").text(e[0]+" - "+e[1]),i()}var r=$(t),a=r.find(".rating_range"),i=$.fp.debounce(function(){var t=r.find("form");$.ajax({url:t.attr("action"),data:t.serialize(),type:"POST",success:function(t){e.setFilter(t)}})},200);r.find("input").change(i),r.find("button.reset").click(function(){r.find("label input").prop("checked",!0).trigger("change"),r.find(".rating_range").each(function(){var e=$(this),t=[e.slider("option","min"),e.slider("option","max")];e.slider("values",t),n(t)})}),r.find("button").click(function(){return e.toggleFilter(),o.redraw(),!1}),a.each(function(){var e=$(this),t=e.find("input"),r=e.siblings(".range"),o=t.data("min"),a=t.data("max"),i=t.val()?t.val().split("-"):[o,a];r.text(i.join(" - ")),e.slider({range:!0,min:o,max:a,values:i,step:50,slide:function(e,t){n(t.values)}})})}var o=e("mithril"),a=e("chessground").util;t.exports={toggle:function(e,t){return o("span",{"class":"filter_toggle"+(e.vm.filterOpen?" active":""),onclick:a.partial(e.toggleFilter)},[e.vm.filterOpen?o("span[data-icon=L]"):o("span",{"class":"hint--bottom-left","data-hint":e.trans("filterGames")},o("span[data-icon=%]")),t>0?o("span.number",t):null])},render:function(e){return o("div.hook_filter",{config:function(t,n,o){o.loaded||$.ajax({url:"/setup/filter",cache:!1,success:function(n){t.innerHTML=n,o.loaded=!0,r(e,t)}})}})}}},{chessground:13,mithril:18}],31:[function(e,t,n){function r(e,t){return s("tr",{key:t.id,title:t.disabled?"":"join"===t.action?e.trans("joinTheGame")+" - "+t.perf.name:e.trans("cancel"),"data-id":t.id,"class":"hook "+t.action+(t.disabled?" disabled":"")},l([s("span",{"class":"is is2 color-icon "+(t.color||"random")}),t.rating?s("a.ulink",{href:"/@/"+t.username},t.username):"Anonymous",t.rating?t.rating:"",t.clock,[s("span",{"class":"varicon","data-icon":t.perf.icon}),e.trans(1===t.mode?"rated":"casual")]]))}function o(e){return function(t){return"standard"===t.variant.key===e}}function a(e){return"cancel"===e.action}function i(e){return!a(e)}var s=e("mithril"),c=e("chessground").util,l=e("../util").tds,u=e("../../hookRepo");t.exports={toggle:function(e){return s("span",{"data-hint":e.trans("graph"),"class":"mode_toggle hint--bottom",onclick:c.partial(e.setMode,"chart")},s("span.chart[data-icon=9]"))},render:function(e,t){var n=t.filter(a)[0],d=t.slice(0),f=c.partial(r,e),h=d.filter(i).filter(o(!0));u.sort(e,h);var p=d.filter(i).filter(o(!1));$('#start_buttons').css('vertical-align','top');u.sort(e,p);var m=[h.map(f),p.length?s("tr.variants",{key:"variants"},s("td",{colspan:5},"— "+e.trans("variant")+" —")):null,p.map(f)];return n&&m.unshift(f(n)),s("table.table_wrap",[s("thead",s("tr",[s("th"),s("th",e.trans("player")),s("th",{"class":c.classSet({sortable:!0,sort:"rating"===e.vm.sort}),onclick:c.partial(e.setSort,"rating")},[s("i.is"),e.trans("rating")]),s("th",{"class":c.classSet({sortable:!0,sort:"time"===e.vm.sort}),onclick:c.partial(e.setSort,"time")},[s("i.is"),e.trans("time")]),s("th",e.trans("mode"))])),s("tbody",{"class":e.vm.stepping?"stepping":"",onclick:function(t){var n=t.target;if(!n.classList.contains("ulink"))do if(n=n.parentNode,"TR"===n.nodeName)return e.clickHook(n.getAttribute("data-id"));while("TABLE"!==n.nodeName)}},m)])}}},{"../../hookRepo":21,"../util":34,chessground:13,mithril:18}],32:[function(e,t,n){var r=(e("mithril"),e("./list")),o=e("./chart"),a=e("../../filter"),i=e("./filter");t.exports=function(e){var t,n,s,c;switch(e.vm.filterOpen&&(t=i.render(e)),e.vm.mode){case"chart":var l=a(e,e.data.hooks),u=l.visible;s=l.hidden,n=t||o.render(e,u),c=e.vm.filterOpen?null:o.toggle(e);break;default:var l=a(e,e.vm.stepHooks),u=l.visible;s=l.hidden,n=t||r.render(e,u),c=e.vm.filterOpen?null:r.toggle(e)}var d=i.toggle(e,s);return[d,c,n]}},{"../../filter":20,"./chart":29,"./filter":30,"./list":31,mithril:18}],33:[function(e,t,n){function r(e,t,n,r){var i={onclick:a.partial(e.setTab,t)};return t===n&&(i["class"]="active"),o("a",i,r)}var o=e("mithril"),a=e("chessground").util;t.exports=function(e){var t=e.data.nowPlaying.filter(function(e){return e.isMyTurn}).length,n=e.vm.tab;return[r(e,"real_time",n,e.trans("realTime")),r(e,"seeks",n,e.trans("correspondence")),"now_playing"===n||e.data.nbNowPlaying>0?r(e,"now_playing",n,[e.trans("nbGamesInPlay",e.data.nbNowPlaying),t>0?o("span.unread",t):null]):null]}},{chessground:13,mithril:18}],34:[function(e,t,n){e("mithril");t.exports={tds:function(e){return e.map(function(e){return{tag:"td",children:[e]}})}}},{mithril:18}],35:[function(e,t,n){function r(e){return e+"?_="+(new Date).getTime()}var o=e("mithril"),a=function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Accept","application/vnd.lichess.v1+json")};t.exports={seeks:function(){return o.request({method:"GET",url:r("/lobby/seeks"),config:a})},nowPlaying:function(){return o.request({method:"GET",url:r("/account/info"),config:a}).then(function(e){return e.nowPlaying})}}},{mithril:18}]},{},[1])(1)});
